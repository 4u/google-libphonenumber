#!/bin/bash

PWD=$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)

git checkout -b support/update-libphonenumber-${1//\./\-}

curl -L https://github.com/googlei18n/libphonenumber/archive/libphonenumber-$1.tar.gz | tar -xvf - --strip-components=4 -C $PWD/../lib/closure/goog/i18n/phonenumbers --include=*javascript/i18n/phonenumbers*

chmod +x node_modules/seegno-closure-library/closure/bin/build/depswriter.py

rm ./lib/closure/goog/deps.js && node_modules/seegno-closure-library/closure/bin/build/depswriter.py --root_with_prefix="./lib/closure/goog '<basePath>/lib/closure/goog'" | sed -E '/metadatalite|metadatafortesting/d' | sed -E $'s/\'<basePath>/basePath + \'/' > ./lib/closure/goog/deps.js

npm test

git add $PWD/../lib/

git commit -m "Update libphonenumber@$1"
